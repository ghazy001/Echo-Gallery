<!DOCTYPE html>
{% load static %}
<html>
<head>
    <meta charset="utf-8">
    <title>Article Stats</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'dashboard/css/styles.css' %}">
    <style>
      .card-block {
        background:#fff;
        border-radius:8px;
        box-shadow:0 2px 8px rgba(0,0,0,.05);
        padding:16px;
        margin-bottom:20px;
        font-size:14px;
      }
      .kpi-grid {
        display:grid;
        grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
        gap:16px;
      }
      .kpi-card {
        background:#fff;
        border-radius:8px;
        border:1px solid #eee;
        box-shadow:0 2px 6px rgba(0,0,0,.04);
        padding:16px;
        display:flex;
        flex-direction:column;
        gap:6px;
      }
      .kpi-label {
        font-size:11px;
        font-weight:600;
        color:#555;
        text-transform:uppercase;
        letter-spacing:.03em;
      }
      .kpi-value {
        font-size:24px;
        font-weight:600;
        line-height:1.2;
        color:#222;
      }
      .kpi-hint {
        font-size:12px;
        color:#777;
        line-height:1.3;
      }

      .section-header {
        font-size:14px;
        font-weight:600;
        color:#222;
        display:flex;
        align-items:center;
        justify-content:space-between;
        flex-wrap:wrap;
        gap:8px;
        padding:0 16px 12px;
      }
      .section-header .meta {
        font-size:12px;
        font-weight:400;
        color:#777;
      }

      .table-wrap {
        overflow-x:auto;
        border-top:1px solid #eee;
      }
      table.stats-table {
        width:100%;
        border-collapse:collapse;
        font-size:14px;
      }
      table.stats-table thead th {
        text-align:left;
        border-bottom:2px solid #ddd;
        padding:10px;
        font-size:12px;
        font-weight:600;
        color:#555;
        text-transform:uppercase;
        letter-spacing:.03em;
        white-space:nowrap;
      }
      table.stats-table tbody td {
        border-bottom:1px solid #eee;
        padding:10px;
        vertical-align:top;
      }
      table.stats-table tbody tr:last-child td {
        border-bottom:none;
      }

      .text-right { text-align:right; }
      .muted {
        color:#777;
        font-size:12px;
      }
      .btn-link {
        background:none;
        border:none;
        color:#3498db;
        font-size:12px;
        font-weight:600;
        text-decoration:none;
        padding:0;
        cursor:pointer;
      }
      .btn-outline-back {
        color:#333;
        border:1px solid #ccc;
        background:#fff;
        border-radius:4px;
        padding:8px 12px;
        font-size:13px;
        font-weight:600;
        text-decoration:none;
        display:inline-block;
      }

      @media(max-width:700px){
        .section-header {
          flex-direction:column;
          align-items:flex-start;
        }
      }
    </style>
</head>
<body>
<div class="grid-container">

  {% include "dashboard/partials/header.html" %}
  {% include "dashboard/partials/sidebar.html" %}

  <main class="main-container">

      <!-- PAGE TITLE / ACTIONS -->
      <div class="main-title" style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;">
          <h2>ARTICLE STATS</h2>

          <a href="{% url 'dashboard_article_list' %}"
             class="btn-outline-back">
             ← Back to Articles
          </a>
      </div>

      <div style="font-size:13px;color:#777;margin-bottom:20px;">
        Snapshot generated at {{ now|date:"Y-m-d H:i" }}
      </div>

      <!-- KPI CARDS -->
      <section class="kpi-grid" style="margin-bottom:24px;">

        <div class="kpi-card">
          <div class="kpi-label">Total Articles</div>
          <div class="kpi-value">{{ total_articles }}</div>
          <div class="kpi-hint">All articles in the system</div>
        </div>

        <div class="kpi-card" style="border-left:4px solid #2ecc71;">
          <div class="kpi-label" style="color:#2ecc71;">Published</div>
          <div class="kpi-value" style="color:#2ecc71;">{{ published_articles }}</div>
          <div class="kpi-hint">{{ published_pct }}% are public</div>
        </div>

        <div class="kpi-card" style="border-left:4px solid #999;">
          <div class="kpi-label" style="color:#999;">Draft / Hidden</div>
          <div class="kpi-value" style="color:#999;">{{ draft_articles }}</div>
          <div class="kpi-hint">is_published = False</div>
        </div>

        <div class="kpi-card" style="border-left:4px solid #3498db;">
          <div class="kpi-label" style="color:#3498db;">Last 30 Days</div>
          <div class="kpi-value" style="color:#3498db;">{{ articles_last_30_days }}</div>
          <div class="kpi-hint">New / updated content recently</div>
        </div>

      </section>

      <!-- ARTICLES BY CATEGORY -->
      <section class="card-block">
        <div class="section-header">
          <div>
            <div>Articles by Category</div>
            <div class="meta">Which topics hold the most content</div>
          </div>
        </div>

        <div class="table-wrap">
          <table class="stats-table">
            <thead>
              <tr>
                <th>Category</th>
                <th class="text-right"># Articles</th>
                <th class="text-right">Actions</th>
              </tr>
            </thead>
            <tbody>
            {% if articles_by_category %}
              {% for row in articles_by_category %}
                <tr>
                  <td style="font-weight:600;color:#222;">
                    {{ row.category__name }}
                  </td>
                  <td class="text-right" style="font-weight:600;color:#222;">
                    {{ row.article_count }}
                  </td>
                  <td class="text-right">
                    <a class="btn-link"
                       href="{% url 'dashboard_article_list' %}?category={{ row.category__id }}">
                      view articles ›
                    </a>
                  </td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="3" style="text-align:center;color:#777;padding:20px;">
                  No data.
                </td>
              </tr>
            {% endif %}
            </tbody>
          </table>
        </div>
      </section>

      <!-- ARTICLES BY AUTHOR -->
      <section class="card-block">
        <div class="section-header">
          <div>
            <div>Articles by Author</div>
            <div class="meta">Who's writing the most</div>
          </div>
        </div>

        <div class="table-wrap">
          <table class="stats-table">
            <thead>
              <tr>
                <th>Author</th>
                <th class="text-right"># Articles</th>
                <th class="text-right">Actions</th>
              </tr>
            </thead>
            <tbody>
            {% if articles_by_author %}
              {% for row in articles_by_author %}
                <tr>
                  <td style="font-weight:600;color:#222;">
                    {% if row.author__username %}
                      {{ row.author__username }}
                    {% else %}
                      <span class="muted">No author</span>
                    {% endif %}
                  </td>
                  <td class="text-right" style="font-weight:600;color:#222;">
                    {{ row.article_count }}
                  </td>
                  <td class="text-right">
                    {% if row.author_id %}
                      <a class="btn-link"
                         href="{% url 'dashboard_article_list' %}?author={{ row.author_id }}">
                        view articles ›
                      </a>
                    {% else %}
                      <span class="muted">—</span>
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="3" style="text-align:center;color:#777;padding:20px;">
                  No data.
                </td>
              </tr>
            {% endif %}
            </tbody>
          </table>
        </div>
      </section>

      <!-- ARTICLES PER MONTH -->
      <section class="card-block">
        <div class="section-header">
          <div>
            <div>Articles per Month</div>
            <div class="meta">Grouped by published date</div>
          </div>
        </div>

        <div class="table-wrap">
          <table class="stats-table">
            <thead>
              <tr>
                <th>Month</th>
                <th class="text-right"># Articles</th>
                <th class="text-right">Actions</th>
              </tr>
            </thead>
            <tbody>
            {% if articles_by_month %}
              {% for row in articles_by_month %}
                <tr>
                  <td>
                    <div style="font-weight:600;color:#222;">
                      {{ row.month|date:"F Y" }}
                    </div>
                    <div class="muted">
                      {{ row.range_start }} → {{ row.range_end }}
                    </div>
                  </td>
                  <td class="text-right" style="font-weight:600;color:#222;">
                    {{ row.article_count }}
                  </td>
                  <td class="text-right">
                    <a class="btn-link"
                       href="{% url 'dashboard_article_list' %}?date_from={{ row.range_start }}&date_to={{ row.range_end }}">
                      view articles ›
                    </a>
                  </td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="3" style="text-align:center;color:#777;padding:20px;">
                  No data.
                </td>
              </tr>
            {% endif %}
            </tbody>
          </table>
        </div>
      </section>

      <!-- BACK LINK -->
      <div style="text-align:right; margin-top:20px;">
        <a href="{% url 'dashboard_article_list' %}"
           class="btn-outline-back">
           ← Back to Articles
        </a>
      </div>

  </main>
</div>
<script src="{% static 'dashboard/js/scripts.js' %}"></script>
</body>
</html>
